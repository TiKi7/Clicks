let a=false;let p=0;let k=0;let w=0;let y=0;function e(){let a=document.querySelector("#hatch");let r=a.offsetTop;let f=a.offsetLeft;addEventListener("mousemove",function(e){let t=document.querySelector("#vr");let n=document.querySelector("#hr");let i=t.querySelector("span");let c=n.querySelector("span");let l=document.querySelector("#middle");let o=l.querySelector("#canvas");p=e.clientX;k=e.clientY;try{t.style.left=e.clientX-l.offsetLeft-w+"px";n.style.top=e.clientY-l.offsetTop-y+"px";i.innerText=(e.clientX-w-o.offsetLeft).toFixed(2)+"px";c.innerText=(e.clientY-y-o.offsetTop).toFixed(2)+"px"}catch(e){console.log(e)}let d=100;let u=e.clientX/this.window.innerWidth;let s=e.clientY/this.window.innerWidth;let m=(u-.5)*d;let v=(s-.5)*d;a.style.top=r+v+"px";a.style.left=f+m+"px"})}e();let r=[];document.querySelectorAll(".elem").forEach(e=>{r.push(e)});let f=document.querySelector('.elem[active="1"]');function h(){let e=document.querySelector("#script #names #w");let t=document.querySelector("#script #data #w");let n="";let i="100|100|";if(r.length>0){r.forEach(e=>{n+=`${e.getAttribute("clicks-id")}|${e.getAttribute("clicks-event")}|\n`;i+=`${Number(e.style.left.slice(0,-1)).toFixed(2)}|${Number(e.style.top.slice(0,-1)).toFixed(2)}|${(100-Number(e.style.right.slice(0,-1))).toFixed(2)}|${(100-Number(e.style.bottom.slice(0,-1))).toFixed(2)}|`})}else{e.textContent="...";t.textContent="..."}e.textContent=n;t.textContent=i}h();let c=new Audio("sounds/copy.flac");let E=new Audio("sounds/ToF_click_03.flac");let u=new Audio("sounds/clicking.flac");let t=new Audio("sounds/key_down.flac");document.querySelectorAll(".btn").forEach(e=>{e.addEventListener("click",e=>{u.currentTime=0;u.play()})});n();function n(){let o=document.querySelector("#tooltip div #tip #w");let d=document.querySelector("#tooltip div #desc #w");let u=document.querySelector("#tooltip div #key #w");document.querySelectorAll("[tip]").forEach(t=>{let n=t.getAttribute("tip")||"";let i=t.getAttribute("desc")||"";let c=t.getAttribute("key")||"";t.addEventListener("mouseenter",e);t.addEventListener("mouseleave",l);function e(e){if(e.target!=t){return}o.innerText=n;d.innerText=i;u.innerText=c}function l(e){o.innerText="";d.innerText="";u.innerText=""}})}function l(){document.querySelectorAll(".output").forEach(e=>{let t=e.querySelector("#copy");let n=e.querySelector("#w");t.addEventListener("click",function(e){navigator.clipboard.writeText(n.textContent);c.currentTime=0;c.play()})})}l();o();function o(){let e=document.querySelector("#middle");let t=e.querySelector("#canvas");let n=0,i=0,c=0,l=0;e.addEventListener("mousedown",o);function o(e){if(a){return}if(e.which!=2){return}e.preventDefault();c=e.clientX;l=e.clientY;addEventListener("mouseup",u);addEventListener("mousemove",d)}function d(e){n=c-e.clientX;i=l-e.clientY;c=e.clientX;l=e.clientY;t.style.top=t.offsetTop-i+"px";t.style.left=t.offsetLeft-n+"px"}function u(e){removeEventListener("mouseup",u);removeEventListener("mousemove",d)}}document.querySelector("#canvas").style.height="70%";addEventListener("wheel",d);function d(e){if(a){return}let t=document.querySelector("#canvas");let n=1;let i=.1;if(e.shiftKey){i=.4}if(e.deltaY<0){n=-1;t.style.height=parseFloat(t.style.height)*(1+i)+"%"}else if(e.deltaY>0){n=1;t.style.height=parseFloat(t.style.height)*(1-i)+"%"}let c=t.getBoundingClientRect();let l=(e.clientX-c.left)/c.width;let o=(e.clientY-c.top)/c.height;t.style.left=c.left+c.width*i*l*n+"px";t.style.top=c.top+c.height*i*o*n+"px"}document.querySelectorAll(".elem").forEach(e=>{m(e)});function m(l){let t=document.querySelector("#event #display");l.addEventListener("mouseover",e=>{t.textContent=`${l.getAttribute("clicks-id")} | ${l.getAttribute("clicks-event")}`});l.addEventListener("mouseleave",e=>{t.textContent="@Tiki"});l.addEventListener("mousedown",e);let o={x:0,y:0,t:null,i:null};let d=document.querySelector("#canvas");function e(e){if(a){return}if(e.which!=1){return}if(e.shiftKey){l.setAttribute("select",1)}else{document.querySelectorAll(".elem").forEach(e=>{e.setAttribute("select",0)});l.setAttribute("select",1)}if(l.getAttribute("active")!=1){document.querySelectorAll(".elem").forEach(e=>{e.setAttribute("active",0)});l.setAttribute("active",1);f=l}let t=document.querySelector("#event #input #id");t.value=l.getAttribute("clicks-id");let n=document.querySelector("#event #input #event");n.value=l.getAttribute("clicks-event");r.forEach(e=>{e.style.zIndex=0});l.style.zIndex=1;if(e.shiftKey){return}document.querySelector("#app #middle").classList.add("no-cursor");let i=l.querySelector(".pin#upper");let c=l.querySelector(".pin#lower");o.x=e.clientX;o.y=e.clientY;o.t=l.getBoundingClientRect();o.i=d.getBoundingClientRect();if(e.target==i){w=e.clientX-l.getBoundingClientRect().left;y=e.clientY-l.getBoundingClientRect().top;addEventListener("mousemove",u)}else if(e.target==c){w=e.clientX-l.getBoundingClientRect().right;y=e.clientY-l.getBoundingClientRect().bottom;addEventListener("mousemove",s)}else{addEventListener("mousemove",m)}addEventListener("mouseup",v)}function u(e){x({x:e.clientX,y:e.clientY},l,o)}function s(e){L({x:e.clientX,y:e.clientY},l,o)}function m(e){b({x:e.clientX,y:e.clientY},l,o)}function v(e){w=0;y=0;document.querySelector("#app #middle").classList.remove("no-cursor");removeEventListener("mousemove",u);removeEventListener("mousemove",s);removeEventListener("mousemove",m);removeEventListener("mouseup",v);h();E.currentTime=0;E.play()}}function x(e,t,n){let i=30;let c=n.x-n.t.left;let l=n.y-n.t.top;let o=e.x-c;let d=e.y-l;if(o<n.i.left){o=n.i.left}if(o>n.i.right){o=n.i.right}if(o>t.getBoundingClientRect().right-i){o=t.getBoundingClientRect().right-i}if(d<n.i.top){d=n.i.top}if(d>n.i.bottom){d=n.i.bottom}if(d>t.getBoundingClientRect().bottom-i){d=t.getBoundingClientRect().bottom-i}let u=o-n.i.left;let s=d-n.i.top;let m=(u/n.i.width*100).toFixed(2);let v=(s/n.i.height*100).toFixed(2);t.style.left=m+"%";t.style.top=v+"%"}function L(e,t,n){let i=30;let c=n.x-n.t.right;let l=n.y-n.t.bottom;let o=e.x-c;let d=e.y-l;if(o<n.i.left){o=n.i.left}if(o>n.i.right){o=n.i.right}if(o<t.getBoundingClientRect().left+i){o=t.getBoundingClientRect().left+i}if(d<n.i.top){d=n.i.top}if(d>n.i.bottom){d=n.i.bottom}if(d<t.getBoundingClientRect().top+i){d=t.getBoundingClientRect().top+i}let u=(n.i.right-o)/n.i.width*100;let s=(n.i.bottom-d)/n.i.height*100;t.style.right=u+"%";t.style.bottom=s+"%"}function b(e,t,n){let i=n.x-n.t.left;let c=n.y-n.t.top;let l=e.x-i;let o=e.y-c;if(l<n.i.left){l=n.i.left}if(l>n.i.right-t.offsetWidth){l=n.i.right-t.offsetWidth}if(o<n.i.top){o=n.i.top}if(o>n.i.bottom-t.offsetHeight){o=n.i.bottom-t.offsetHeight}let d=l-n.i.left;let u=o-n.i.top;let s=(d/n.i.width*100).toFixed(2);let m=(u/n.i.height*100).toFixed(2);let v=100-((d+t.offsetWidth)/n.i.width*100).toFixed(2);let a=100-((u+t.offsetHeight)/n.i.height*100).toFixed(2);t.style.left=s+"%";t.style.top=m+"%";t.style.right=v+"%";t.style.bottom=a+"%"}addEventListener("keydown",s);function s(e){let t=document.querySelector("#event #input #id");let n=document.querySelector("#event #input #event");if(e.repeat){return}console.log(e.code);if(e.code=="Tab"){e.preventDefault();if(document.activeElement!=t){t.focus()}else{n.focus()}}else if(e.code=="Enter"){t.blur();n.blur()}if(document.activeElement==t||document.activeElement==n){return}if(e.code=="KeyG"){v()}else if(e.code=="KeyA"&&!e.shiftKey){$()}else if(e.code=="Escape"&&!e.shiftKey){g()}else if(e.code=="KeyA"&&e.shiftKey){F()}else if(e.code=="KeyX"){R()}else if(e.code=="KeyD"&&e.shiftKey){A()}}function v(){if(a){return}if(f==null){return}addEventListener("mousemove",l);addEventListener("mouseup",o);a=true;let t=document.querySelector("#canvas");let n=document.querySelectorAll('.elem[select="1"]');let c=[];n.forEach(e=>{c.push({x:p,y:k,i:t.getBoundingClientRect(),t:e.getBoundingClientRect()})});function l(e){for(i=0;i<n.length;i++){b({x:p,y:k},n[i],c[i])}}function o(e){a=false;removeEventListener("mousemove",l);removeEventListener("mouseup",o);h();E.currentTime=0;E.play()}}function $(){document.querySelectorAll(".elem").forEach(e=>{e.setAttribute("select",1)})}function g(){document.querySelectorAll(".elem").forEach(e=>{e.setAttribute("active",0);e.setAttribute("select",0)})}function F(){if(a){return}r.forEach(e=>{e.setAttribute("select",0);e.setAttribute("active",0)});let e=document.querySelector("#middle #canvas #elem-container");let t=_('<div class="elem" style="inset: 0% 0% 0% 0%;" active=1 select=1 clicks-id="no-id" clicks-event="no-event"><div id="error"><div class="stripes"></div></div><div class="outer"><div class="pin" id="upper"><div></div></div><div class="pin" id="lower"><div></div></div></div></div>');e.append(t);r.push(t);f=t;m(t);let n=document.querySelector("#middle #canvas");let i=(p-n.getBoundingClientRect().left)/n.getBoundingClientRect().width*100;let c=(k-n.getBoundingClientRect().top)/n.getBoundingClientRect().height*100;let l=15;let o=i+"%";let d=c+"%";let u=100-l-i+"%";let s=100-l*n.getBoundingClientRect().width/n.getBoundingClientRect().height-c+"%";t.style.inset=`${d} ${u} ${s} ${o}`;v()}function _(e){var t=document.createElement("div");t.innerHTML=e.trim();return t.firstChild}function A(){let t=document.querySelector("#middle #canvas #elem-container");let n=[];document.querySelectorAll('.elem[select="1"]').forEach(e=>{let t=e.cloneNode(true);e.setAttribute("select",0);e.setAttribute("active",0);t.setAttribute("clicks-id","no-id");t.setAttribute("clicks-event","no-event");if(t.getAttribute("active")=="1"){f=t}n.push(t)});n.forEach(e=>{t.append(e);r.push(e);m(e)});v()}function R(){let t=[];let n=[];document.querySelectorAll('.elem[select="1"]').forEach(e=>{t.push(e)});document.querySelectorAll('.elem[select="0"]').forEach(e=>{n.push(e)});while(t.length>0){t.pop().remove()}r=n;h()}function K(){document.querySelector("#left #add").addEventListener("click",e=>{F()});document.querySelector("#left #remove").addEventListener("click",e=>{R()});document.querySelector("#left #select").addEventListener("click",e=>{$()});document.querySelector("#left #deselect").addEventListener("click",e=>{g()});document.querySelector("#left #duplicate").addEventListener("click",e=>{A()});document.querySelector("#left #move").addEventListener("click",e=>{v()})}K();function N(){let t=document.querySelector("#event #input #id");let n=document.querySelector("#event #input #event");t.addEventListener("focus",e=>{e.target.select()});n.addEventListener("focus",e=>{e.target.select()});t.addEventListener("keydown",e=>{T()});n.addEventListener("keydown",e=>{T()});t.addEventListener("keyup",e=>{if(f!=null){f.setAttribute("clicks-id",t.value!=""?t.value:"no-id");h()}});n.addEventListener("keyup",e=>{if(f!=null){f.setAttribute("clicks-event",n.value!=""?n.value:"no-event");h()}})}N();function T(e){if(e.repeat){return}t.currentTime=0;t.play()}C();function C(){let c=document.querySelector("#canvas");let l=document.querySelector("#my-img");let o=document.querySelector("#middle #canvas #shade");let t=document.createElement("input");t.type="file";t.addEventListener("change",e);function e(e){let t=e.target,n=t.files;if(FileReader&&n&&n.length){var i=new FileReader;i.onload=function(){l.src=i.result};i.readAsDataURL(n[0]);c.removeEventListener("click",d);c.classList.remove("first");o.style.opacity=.8;document.querySelectorAll(".border4").forEach(e=>{e.style.visibility="visible"})}}let n=document.querySelector("#top #toolbar #load-image");n.addEventListener("click",d);c.addEventListener("click",d);function d(e){u.currentTime=0;u.play();t.click()}}document.querySelector("#top #toolbar #clear").addEventListener("click",e=>{r.forEach(e=>{e.remove()});document.querySelector("#script #names #w").textContent="...";document.querySelector("#script #data #w").textContent="..."});function j(e,t){var n="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(e));var i=document.createElement("a");i.setAttribute("href",n);i.setAttribute("download",t+".json");document.body.appendChild(i);i.click();i.remove()}document.querySelector("#top #toolbar #save").addEventListener("click",e=>{let t={check:"Clicks@Tiki",data:[]};r.forEach(e=>{t["data"].push({inset:e.style.inset,id:e.getAttribute("clicks-id"),event:e.getAttribute("clicks-event")})});j(t,"clicksExport")});document.querySelector("#top #toolbar #load").addEventListener("click",e=>{let t=document.createElement("input");t.type="file";t.addEventListener("change",e=>{let t=e.target,n=t.files;new Response(n[0]).json().then(e=>{if("check"in e&&e["check"]=="Clicks@Tiki"&&"data"in e){r.forEach(e=>{e.remove()});e.data.forEach(e=>{let t=document.querySelector("#middle #canvas #elem-container");let n=_('<div class="elem" style="inset: 0% 0% 0% 0%;" active=0 select=0 clicks-id="no-id" clicks-event="no-event"><div id="error"><div class="stripes"></div></div><div class="outer"><div class="pin" id="upper"><div></div></div><div class="pin" id="lower"><div></div></div></div></div>');n.setAttribute("clicks-id",e["id"]);n.setAttribute("clicks-event",e["event"]);n.style.inset=e.inset;t.append(n);r.push(n);m(n)});h()}},e=>{console.log(e)})});t.click()});function I(){document.querySelector("#top #theme #t1").addEventListener("click",e=>{document.querySelectorAll(".theme").forEach(e=>{e.classList.remove("t1","t2","t3","t4");e.classList.add("t1")})});document.querySelector("#top #theme #t2").addEventListener("click",e=>{document.querySelectorAll(".theme").forEach(e=>{e.classList.remove("t1","t2","t3","t4");e.classList.add("t2")})});document.querySelector("#top #theme #t3").addEventListener("click",e=>{document.querySelectorAll(".theme").forEach(e=>{e.classList.remove("t1","t2","t3","t4");e.classList.add("t3")})});document.querySelector("#top #theme #t4").addEventListener("click",e=>{document.querySelectorAll(".theme").forEach(e=>{e.classList.remove("t1","t2","t3","t4");e.classList.add("t4")})})}I();let J=0;let O=0;let D=0;let G=0;addEventListener("mousemove",function(e){let t=document.querySelector("#vr");let n=document.querySelector("#hr");let i=t.querySelector("span");let c=n.querySelector("span");let l=document.querySelector("#middle");let o=l.querySelector("#canvas");J=e.clientX;O=e.clientY;try{t.style.left=e.clientX-l.offsetLeft-D+"px";n.style.top=e.clientY-l.offsetTop-G+"px";i.innerText=e.clientX-D-o.offsetLeft+"px";c.innerText=e.clientY-G-o.offsetTop+"px"}catch(e){console.log(e)}});S();function S(){let o=document.querySelector("#tooltip div #tip #w");let d=document.querySelector("#tooltip div #desc #w");let u=document.querySelector("#tooltip div #key #w");document.querySelectorAll("[tip]").forEach(t=>{let n=t.getAttribute("tip")||"";let i=t.getAttribute("desc")||"";let c=t.getAttribute("key")||"";t.addEventListener("mouseenter",e);t.addEventListener("mouseleave",l);function e(e){if(e.target!=t){return}o.innerText=n;d.innerText=i;u.innerText=c}function l(e){o.innerText="";d.innerText="";u.innerText=""}})}U();function U(){let e=document.querySelector("#middle");let t=e.querySelector("#canvas");let n=0,i=0,c=0,l=0;e.addEventListener("mousedown",o);function o(e){if(e.which!=2){return}e.preventDefault();c=e.clientX;l=e.clientY;addEventListener("mouseup",u);addEventListener("mousemove",d)}function d(e){n=c-e.clientX;i=l-e.clientY;c=e.clientX;l=e.clientY;t.style.top=t.offsetTop-i+"px";t.style.left=t.offsetLeft-n+"px"}function u(e){removeEventListener("mouseup",u);removeEventListener("mousemove",d)}}document.querySelector("#canvas").style.height="70%";addEventListener("wheel",X);function X(e){let t=document.querySelector("#canvas");let n=1;let i=.1;if(e.shiftKey){i=.4}if(e.deltaY<0){n=-1;t.style.height=parseFloat(t.style.height)*(1+i)+"%"}else if(e.deltaY>0){n=1;t.style.height=parseFloat(t.style.height)*(1-i)+"%"}let c=t.getBoundingClientRect();let l=(e.clientX-c.left)/c.width;let o=(e.clientY-c.top)/c.height;t.style.left=c.left+c.width*i*l*n+"px";t.style.top=c.top+c.height*i*o*n+"px"}q();function q(){let c=document.querySelector("#canvas");let l=document.querySelector("#my-img");let o=document.querySelector("#middle #canvas #shade");let t=document.createElement("input");t.type="file";t.addEventListener("change",e);function e(e){let t=e.target,n=t.files;if(FileReader&&n&&n.length){var i=new FileReader;i.onload=function(){l.src=i.result};i.readAsDataURL(n[0]);c.removeEventListener("click",d);c.classList.remove("first");o.style.opacity=.8}}let n=document.querySelector("#top #load-image");n.addEventListener("click",d);c.addEventListener("click",d);function d(e){t.click()}}